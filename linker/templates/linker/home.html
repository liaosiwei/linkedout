{% extends "linker/base.html" %} 
{% load staticfiles %} 
{% load linker_extras %}
{% block css %}
	<link href="{% static 'linker/css/jquery-ui.css' %}" rel="stylesheet">
	<style type="text/css">
       	#favicon {
      		position: relative; 
      		top: -1px;  
      		witdth: 40px; height: 14px;
      	} 
      	.table th, .table td { 
     		border-top: none; 
 		}
      	.container hr {
/*       		/* border-color: #7D7D7D; */ */
      		border-color: #CFCFCF;
      		margin: 1px, 0;
      	}
		#search-button {
			position: relative;
			right: -4px;
		}
  	</style>
{% endblock %} 
{% block content %}

<div class="tabbable">
<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#sec1">个人主页</a></li>
    <li><a data-toggle="tab" href="#sec2">搜索网页</a></li>
</ul>
</div>
<div class="tab-content">
    <div class="tab-pane active" id="sec1">
		{% if user.is_authenticated %}
			<div>
				{% for container in container_list %}
					<h3>{{ container.name }}</h3>
					<div>
						<table class="table">
							{% for link in container.linker_set.all|dictsort:"id"|filterDeletedLinks %}
									{% if forloop.counter0|divisibleby:"4" %}
										<tr>
									{% endif %}
										<td class="onelink span3">
											<img id="favicon" src="{{link.link | getFavicon }}" />
											<a href="{{link.link}}" target="_blank">{{ link.name }}</a>
										</td>
									{% if forloop.counter|divisibleby:"4" %}
										</tr>
									{% elif forloop.last%}
										{% with count=forloop.counter %}
											{% for i in count|fillTableTd:"4" %}
												<td class="span3"></td>
											{% endfor %}
										{% endwith %}
										</tr>
									{% endif %}
							{% endfor %}
						</table>
						<hr>
					</div>
				{% endfor %}
			</div>
			{% else %}
			<h1>欢迎</h1>
			<p>没有账号<a href="/auths/register"><strong>请注册</strong></a>，登陆后可以使用个性化书签设置</p>
			
			<div>
				<h3>
					<strong>常用网站</strong>
				</h3>
				<div>
					<p>
						<a href="http://www.baidu.com" target="_blank">百度</a>
					</p>
				</div>
			</div>
			{% endif %}
    </div>
    <div class="tab-pane" id="sec2">
	    <div class='row'>
	        <form>
	        <div class='span3 input-append' style="margin-top:6%; margin-left:30%">
	            <input class="span2" style="height:20px;width:400px;" id="search-input" type="text" >
	            <input class="btn" id="search-button" type="button" value="找找新的网站">
	        </div>
	        </form>
	        <div id='query' style="margin-top:13%; margin-left:3%">
	        	<p>here</p>
	        </div>
	    </div>
	</div>

</div>

{% endblock %} 
	
{% block js%}
<script>
	$(document).ready(function(){
		
		function queryReply(data, status){
			var that = $("#query");
			var replace_html = '<table class="table">';
			var i = 0;
			for (; i<Object.keys(data).length; i++) {
				var key = (i+1).toString();
				var table_row = '<tr><td><a href="' + data[key]['link'] + '" target="_blank">'+ data[key]['name'] + '</a></td><td>' + data[key]['tip'] + '</td><tr>';
				replace_html = replace_html + table_row;
			}
			if (i != 0)
				replace_html += '</table>';
			else
				replace_html = '未搜索到记录，请更换关键词再次搜索，谢谢。';
			that.html(replace_html);
		}
		
		$("#search-input").keypress(function(e){
			if (e.which == 13) {
				$(this).blur();
				$("#search-button").click();
				return false;
			}
		});
		
		$("#search-button").click(function(){
			var queryData = {};
			queryData['query'] = $("#search-input").val();
			$.ajax({
				url: "/ajaxSearch/",
				type: "POST",
				data: queryData,
				success: queryReply
			});
		});
	})
</script>
{% endblock %}
